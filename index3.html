<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="/faq/manifest.json">
    <link rel="icon" href="/faq/icon-192x192.png">
    <title>Leitor Q&A</title>
    <!-- Adicionando as bibliotecas necess√°rias -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/epub.js/0.3.93/epub.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
            overflow: hidden;
            padding-bottom: env(safe-area-inset-bottom);
        }

        header {
            background-color: #6200ee;
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            position: relative;
            z-index: 10;
        }

        #menu-btn {
            position: absolute;
            left: 15px;
            top: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        #content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow: hidden;
            position: relative;
            padding-bottom: env(safe-area-inset-bottom);
        }

        #card {
            width: 100%;
            max-width: 800px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 30px;
            margin: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            touch-action: pan-y;
            cursor: pointer;
            border: 1px solid #e0e0e0;
        }

        #card-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            position: relative;
            -webkit-overflow-scrolling: touch;
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }

        .card-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: auto;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
            flex-shrink: 0;
        }

        .nav-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #6200ee;
            color: white;
            border: none;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .nav-button:hover {
            background-color: #7c29ff;
            transform: scale(1.1);
        }

        #question {
            font-size: 24px;
            margin-bottom: 20px;
            word-wrap: break-word;
            padding: 10px;
            border-radius: 5px;
            transition: background-color 0.2s;
            flex-shrink: 0;
        }

        #question:hover {
            background-color: #f0f0f0;
        }

        #answer {
            font-size: 20px;
            color: #666;
            word-wrap: break-word;
            padding: 10px;
            border-radius: 5px;
            background-color: #f9f9f9;
            margin-top: 10px;
            display: none;
            flex-shrink: 0;
        }

        #answer.visible {
            display: block;
        }

        .counter-container {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0,0,0,0.03);
            border-radius: 20px;
            padding: 5px 10px;
            min-width: 80px;
        }

        #current-card-input {
            width: auto;
            max-width: 50px;
            text-align: center;
            border: 1px solid transparent;
            background: transparent;
            font-size: 16px;
            padding: 2px;
            border-radius: 3px;
            font-family: inherit;
        }

        #current-card-input:focus {
            border-color: #6200ee;
            outline: none;
            background: white;
            min-width: 30px;
            width: auto;
        }

        #total-cards {
            margin-left: 5px;
            white-space: nowrap;
        }

        #card-content::-webkit-scrollbar {
            width: 8px;
        }

        #card-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        #card-content::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        #card-content::-webkit-scrollbar-thumb:hover {
            background: #a0a0a0;
        }

        #menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background: white;
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
            z-index: 20;
            transition: left 0.3s;
            overflow-y: auto;
            padding: 20px;
        }

        #menu.active {
            left: 0;
        }

        .menu-item {
            padding: 15px 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .menu-item:hover {
            background-color: #f5f5f5;
        }

        .menu-item i {
            margin-right: 10px;
            color: #6200ee;
        }

        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 15;
            display: none;
        }

        #overlay.active {
            display: block;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 30;
            width: 90%;
            max-width: 500px;
            display: none;
        }

        .modal.active {
            display: block;
        }

        .modal h2 {
            margin-bottom: 20px;
            color: #6200ee;
        }

        .modal textarea {
            width: 100%;
            height: 300px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 15px;
            resize: none;
            font-family: inherit;
            font-size: 16px;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
        }

        .btn-primary {
            background-color: #6200ee;
            color: white;
        }

        .btn-secondary {
            background-color: #e0e0e0;
            color: #333;
        }

        .font-size-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
        }

        .font-size-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #6200ee;
            color: white;
            border: none;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        #current-font-size {
            margin: 0 15px;
            min-width: 30px;
            text-align: center;
            font-size: 18px;
        }

        #file-input {
            display: none;
        }

        #file-export {
            display: none;
        }

        .search-container-wrapper {
            position: relative;
            margin-top: 10px;
            width: 100%;
        }

        #search-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            margin-top: 5px;
        }

        #search-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .search-buttons {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-top: 5px;
        }

        .search-btn {
            width: 30px;
            height: 30px;
            padding: 0;
            background-color: #6200ee;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .highlight {
            background-color: yellow;
            color: black;
        }

        .current-highlight {
            background-color: orange;
            color: black;
            font-weight: bold;
        }

        .search-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            text-align: center;
        }

        /* Modal de progresso para PDF/EPUB */
        #progress-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 40;
            width: 80%;
            max-width: 400px;
        }

        #progress-modal.active {
            display: block;
        }

        #progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        #progress-bar-fill {
            height: 100%;
            background-color: #6200ee;
            width: 0%;
            transition: width 0.3s;
        }

                #progress-bar-fill {
            height: 100%;
            background-color: #6200ee;
            width: 0%;
            transition: width 0.3s;
        }

        #progress-text {
            text-align: center;
            margin-top: 10px;
        }

        @media (max-width: 600px) {
            #menu {
                width: 80%;
                left: -80%;
            }
            #question {
                font-size: 22px;
            }
            #answer {
                font-size: 18px;
            }
            #card {
                padding: 15px;
                margin: 10px;
            }
            .nav-button {
                width: 32px;
                height: 32px;
                font-size: 16px;
            }
            .counter-container {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <header>
        <button id="menu-btn">‚ò∞</button>
        <h1>Leitor Q&A</h1>
    </header>

    <div id="content">
        <div id="card">
            <div id="card-content">
                <div id="question"></div>
                <div id="answer"></div>
            </div>
            <div class="card-footer">
                <button class="nav-button" id="prev-btn">‚Üê</button>
                <div class="counter-container">
                    <input type="text" id="current-card-input">
                    <span id="total-cards">/ 0</span>
                </div>
                <button class="nav-button" id="next-btn">‚Üí</button>
            </div>
        </div>
    </div>

    <div id="menu">
        <div class="menu-item" id="import-item">
            <i>üìÅ</i> Importar
        </div>
        <div class="menu-item" id="export-item">
            <i>üíæ</i> Exportar
        </div>
        <div class="menu-item" id="toggle-mode">
            <i>üîÑ</i> Alternar Modo
        </div>
        <div class="menu-item" id="edit-item">
            <i>‚úèÔ∏è</i> Editar
        </div>
        <div class="menu-item" id="clear-item">
            <i>üóëÔ∏è</i> Limpar Tudo
        </div>
        <div class="font-size-controls">
            <button class="font-size-btn" id="decrease-font">-</button>
            <span id="current-font-size">16</span>
            <button class="font-size-btn" id="increase-font">+</button>
        </div>
        <div class="search-container-wrapper">
            <div id="search-container">
                <input type="text" id="search-input" placeholder="Pesquisar...">
                <div class="search-buttons">
                    <button class="search-btn" id="search-prev-btn" disabled>‚Üë</button>
                    <button class="search-btn" id="search-next-btn" disabled>‚Üì</button>
                    <button class="search-btn" id="clear-search-btn">‚úï</button>
                </div>
                <div class="search-info" id="search-info"></div>
            </div>
        </div>
    </div>

    <div id="overlay"></div>

    <div class="modal" id="edit-modal">
        <h2>Editar Conte√∫do</h2>
        <textarea id="edit-textarea"></textarea>
        <div class="modal-buttons">
            <button class="btn btn-secondary" id="cancel-edit">Cancelar</button>
            <button class="btn btn-primary" id="save-edit">Salvar</button>
        </div>
    </div>

    <div class="modal" id="progress-modal">
        <h2>Processando Arquivo</h2>
        <div id="progress-bar">
            <div id="progress-bar-fill"></div>
        </div>
        <div id="progress-text">0%</div>
    </div>

    <input type="file" id="file-input" accept=".txt,.pdf,.epub">
    <a id="file-export" download></a>

    <script>
        // Configura√ß√£o inicial do PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';

        // Elementos do DOM
        const menuBtn = document.getElementById('menu-btn');
        const menu = document.getElementById('menu');
        const overlay = document.getElementById('overlay');
        const content = document.getElementById('content');
        const questionEl = document.getElementById('question');
        const answerEl = document.getElementById('answer');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const currentCardInput = document.getElementById('current-card-input');
        const totalCardsEl = document.getElementById('total-cards');
        const importItem = document.getElementById('import-item');
        const exportItem = document.getElementById('export-item');
        const toggleMode = document.getElementById('toggle-mode');
        const editItem = document.getElementById('edit-item');
        const clearItem = document.getElementById('clear-item');
        const editModal = document.getElementById('edit-modal');
        const editTextarea = document.getElementById('edit-textarea');
        const cancelEdit = document.getElementById('cancel-edit');
        const saveEdit = document.getElementById('save-edit');
        const fileInput = document.getElementById('file-input');
        const fileExport = document.getElementById('file-export');
        const increaseFont = document.getElementById('increase-font');
        const decreaseFont = document.getElementById('decrease-font');
        const currentFontSize = document.getElementById('current-font-size');
        const searchInput = document.getElementById('search-input');
        const searchPrevBtn = document.getElementById('search-prev-btn');
        const searchNextBtn = document.getElementById('search-next-btn');
        const clearSearchBtn = document.getElementById('clear-search-btn');
        const searchInfo = document.getElementById('search-info');
        const progressModal = document.getElementById('progress-modal');
        const progressBarFill = document.getElementById('progress-bar-fill');
        const progressText = document.getElementById('progress-text');

        // Vari√°veis de estado
        let items = [];
        let originalItems = [];
        let currentIndex = 0;
        let isQAMode = true;
        let baseFontSize = 16;
        let searchTerm = '';
        let searchResults = [];
        let currentSearchIndex = -1;
        let isFirstSearchClick = true;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            // Configurar eventos
            setupEventListeners();
            
            // Carregar estado salvo ou inicializar
            const savedState = loadState();
            if (savedState) {
                items = savedState.items || [];
                originalItems = savedState.originalItems || [];
                currentIndex = savedState.currentIndex || 0;
                isQAMode = savedState.isQAMode !== undefined ? savedState.isQAMode : true;
                baseFontSize = savedState.baseFontSize || 16;
                
                if (items.length > 0) {
                    updateDisplay();
                    updateCounter();
                }
            } else {
                // Exemplo inicial
                items = [
                    { question: 'Qual √© a capital de Portugal?', answer: 'Lisboa' },
                    { question: 'Quantos planetas tem o sistema solar?', answer: '8' }
                ];
                originalItems = [...items];
                updateDisplay();
                updateCounter();
            }
            
            currentFontSize.textContent = baseFontSize;
            updateFontSize();
        });

        function setupEventListeners() {
            // Menu e overlay
            menuBtn.addEventListener('click', toggleMenu);
            overlay.addEventListener('click', closeMenu);
            
            // Navega√ß√£o
            prevBtn.addEventListener('click', goToPrevCard);
            nextBtn.addEventListener('click', goToNextCard);
            currentCardInput.addEventListener('change', goToCard);
            content.addEventListener('click', toggleAnswer);
            
            // Itens do menu
            importItem.addEventListener('click', () => {
                fileInput.click();
                closeMenu();
            });
            
            exportItem.addEventListener('click', () => {
                exportFile();
                closeMenu();
            });
            
            toggleMode.addEventListener('click', toggleModeHandler);
            editItem.addEventListener('click', editCurrentCard);
            clearItem.addEventListener('click', clearAll);
            
            // Modal de edi√ß√£o
            cancelEdit.addEventListener('click', closeEditModal);
            saveEdit.addEventListener('click', saveEditHandler);
            
            // Importa√ß√£o/exporta√ß√£o
            fileInput.addEventListener('change', handleFileImport);
            
            // Tamanho da fonte
            increaseFont.addEventListener('click', () => changeFontSize(1));
            decreaseFont.addEventListener('click', () => changeFontSize(-1));
            
            // Pesquisa
            searchInput.addEventListener('input', performSearch);
            searchPrevBtn.addEventListener('click', goToPrevSearchResult);
            searchNextBtn.addEventListener('click', goToNextSearchResult);
            clearSearchBtn.addEventListener('click', clearSearch);
            
            // Teclado
            document.addEventListener('keydown', handleKeyDown);
        }
                // Fun√ß√µes principais
        function updateDisplay() {
            if (items.length === 0) {
                questionEl.textContent = 'Nenhum item para mostrar';
                answerEl.textContent = '';
                answerEl.classList.remove('visible');
                return;
            }

            const currentItem = items[currentIndex];
            
            if (isQAMode) {
                questionEl.textContent = currentItem.question || '';
                answerEl.textContent = currentItem.answer || '';
            } else {
                questionEl.textContent = currentItem.text || '';
                answerEl.textContent = '';
            }
            
            highlightText();
            updateCounter();
            saveState();
        }

        function updateCounter() {
            currentCardInput.value = currentIndex + 1;
            totalCardsEl.textContent = `/ ${items.length}`;
        }

        function goToPrevCard() {
            if (items.length === 0) return;
            currentIndex = (currentIndex - 1 + items.length) % items.length;
            updateDisplay();
        }

        function goToNextCard() {
            if (items.length === 0) return;
            currentIndex = (currentIndex + 1) % items.length;
            updateDisplay();
        }

        function goToCard() {
            const newIndex = parseInt(currentCardInput.value) - 1;
            if (!isNaN(newIndex) {
                currentIndex = Math.max(0, Math.min(newIndex, items.length - 1));
                updateDisplay();
            }
        }

        function toggleAnswer() {
            if (isQAMode && items.length > 0) {
                answerEl.classList.toggle('visible');
            }
        }

        function toggleMenu() {
            menu.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function closeMenu() {
            menu.classList.remove('active');
            overlay.classList.remove('active');
        }

        function toggleModeHandler() {
            isQAMode = !isQAMode;
            closeMenu();
            updateDisplay();
        }

        function editCurrentCard() {
            if (items.length === 0) return;
            
            const currentItem = items[currentIndex];
            if (isQAMode) {
                editTextarea.value = `${currentItem.question}\n---\n${currentItem.answer}`;
            } else {
                editTextarea.value = currentItem.text;
            }
            
            editModal.classList.add('active');
            overlay.classList.add('active');
            closeMenu();
        }

        function closeEditModal() {
            editModal.classList.remove('active');
            overlay.classList.remove('active');
        }

        function saveEditHandler() {
            if (items.length === 0) return;
            
            const text = editTextarea.value;
            if (isQAMode) {
                const parts = text.split('\n---\n');
                items[currentIndex] = {
                    question: parts[0] || '',
                    answer: parts[1] || ''
                };
            } else {
                items[currentIndex] = {
                    text: text
                };
            }
            
            closeEditModal();
            updateDisplay();
        }

        function clearAll() {
            if (confirm('Tem certeza que deseja limpar todos os itens?')) {
                items = [];
                originalItems = [];
                currentIndex = 0;
                closeMenu();
                updateDisplay();
                saveState();
            }
        }

        function changeFontSize(change) {
            baseFontSize = Math.max(12, Math.min(40, baseFontSize + change));
            currentFontSize.textContent = baseFontSize;
            updateFontSize();
            saveState();
        }

        function updateFontSize() {
            questionEl.style.fontSize = `${baseFontSize}px`;
            answerEl.style.fontSize = `${baseFontSize - 2}px`;
        }

        function handleKeyDown(e) {
            if (e.key === 'ArrowLeft') {
                goToPrevCard();
            } else if (e.key === 'ArrowRight') {
                goToNextCard();
            } else if (e.key === ' ' || e.key === 'Spacebar') {
                toggleAnswer();
                e.preventDefault();
            }
        }

        // Fun√ß√µes de importa√ß√£o/exporta√ß√£o
        async function handleFileImport(e) {
            const file = e.target.files[0];
            if (!file) return;

            showProgressModal('Processando arquivo...');

            try {
                if (file.name.endsWith('.txt')) {
                    await importTxtFile(file);
                } else if (file.name.endsWith('.pdf')) {
                    await importPdfFile(file);
                } else if (file.name.endsWith('.epub')) {
                    await importEpubFile(file);
                } else {
                    alert('Formato de arquivo n√£o suportado. Use .txt, .pdf ou .epub');
                }
            } catch (error) {
                console.error('Erro ao importar arquivo:', error);
                alert('Erro ao processar arquivo: ' + error.message);
            } finally {
                hideProgressModal();
                fileInput.value = ''; // Reset para permitir reimporta√ß√£o do mesmo arquivo
            }
        }

        async function importTxtFile(file) {
            const text = await file.text();
            const lines = text.split('\n').filter(line => line.trim() !== '');
            
            if (isQAMode) {
                items = [];
                for (let i = 0; i < lines.length; i += 2) {
                    const question = lines[i].trim();
                    const answer = lines[i + 1] ? lines[i + 1].trim() : '';
                    if (question) {
                        items.push({ question, answer });
                    }
                }
            } else {
                items = lines.map(line => ({ text: line.trim() }));
            }
            
            originalItems = [...items];
            currentIndex = 0;
            updateDisplay();
            saveState();
        }

        async function importPdfFile(file) {
            const arrayBuffer = await file.arrayBuffer();
            const loadingTask = pdfjsLib.getDocument(arrayBuffer);
            const pdf = await loadingTask.promise;
            
            items = [];
            const totalPages = pdf.numPages;
            
            for (let i = 1; i <= totalPages; i++) {
                updateProgress(Math.round((i / totalPages) * 100));
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const text = textContent.items.map(item => item.str).join(' ');
                
                if (text.trim()) {
                    if (isQAMode) {
                        // Tenta dividir em perguntas e respostas baseado em padr√µes comuns
                        const qaPairs = extractQAPairsFromText(text);
                        items.push(...qaPairs);
                    } else {
                        items.push({ text: cleanText(text) });
                    }
                }
            }
            
            originalItems = [...items];
            currentIndex = 0;
            updateDisplay();
            saveState();
        }

        async function importEpubFile(file) {
            const arrayBuffer = await file.arrayBuffer();
            const book = new Epub(arrayBuffer);
            
            items = [];
            let totalLocations = 0;
            let processedLocations = 0;
            
            await book.ready;
            totalLocations = book.locations.total;
            
            for (const spineItem of book.spine.contents) {
                const text = await spineItem.load(book.load.bind(book));
                const clean = cleanText(text);
                
                if (clean.trim()) {
                    if (isQAMode) {
                        const qaPairs = extractQAPairsFromText(clean);
                        items.push(...qaPairs);
                    } else {
                        items.push({ text: clean });
                    }
                }
                
                processedLocations += spineItem.locations.length;
                updateProgress(Math.round((processedLocations / totalLocations) * 100));
            }
            
            originalItems = [...items];
            currentIndex = 0;
            updateDisplay();
            saveState();
        }

        function extractQAPairsFromText(text) {
            const qaPairs = [];
            // Padr√µes comuns para identificar perguntas e respostas
            const patterns = [
                /(Q:|P:|Pergunta:|Question:)\s*(.*?)\s*(A:|R:|Resposta:|Answer:)\s*(.*?)(?=\nQ:|P:|Pergunta:|Question:|$)/gis,
                /(.*?\?)\s*(.*?)(?=\n.*?\?|$)/gis
            ];
            
            for (const pattern of patterns) {
                let match;
                while ((match = pattern.exec(text)) !== null) {
                    if (match[1] && match[2] && match[3] && match[4]) {
                        // Padr√£o Q: ... A: ...
                        qaPairs.push({ question: cleanText(match[2]), answer: cleanText(match[4]) });
                    } else if (match[1] && match[2]) {
                        // Padr√£o ...? ...
                        qaPairs.push({ question: cleanText(match[1]), answer: cleanText(match[2]) });
                    }
                }
                
                if (qaPairs.length > 0) break; // Se encontrou com um padr√£o, n√£o tenta os outros
            }
            
            // Se n√£o encontrou padr√µes, divide por linhas alternadas
            if (qaPairs.length === 0) {
                const lines = text.split('\n').filter(line => line.trim() !== '');
                for (let i = 0; i < lines.length; i += 2) {
                    const question = lines[i].trim();
                    const answer = lines[i + 1] ? lines[i + 1].trim() : '';
                    if (question) {
                        qaPairs.push({ question, answer });
                    }
                }
            }
            
            return qaPairs;
        }

        function cleanText(text) {
            // Remove m√∫ltiplos espa√ßos, quebras de linha extras, etc.
            return text.replace(/\s+/g, ' ').trim();
        }
                function showProgressModal(message) {
            progressModal.querySelector('h2').textContent = message;
            progressModal.classList.add('active');
            overlay.classList.add('active');
            progressBarFill.style.width = '0%';
            progressText.textContent = '0%';
        }

        function updateProgress(percent) {
            progressBarFill.style.width = `${percent}%`;
            progressText.textContent = `${percent}%`;
        }

        function hideProgressModal() {
            progressModal.classList.remove('active');
            overlay.classList.remove('active');
        }

        function exportFile() {
            if (items.length === 0) return;
            
            let content;
            if (isQAMode) {
                content = items.map(item => `${item.question}\t${item.answer}`).join('\n');
            } else {
                content = items.map(item => item.text).join('\n');
            }
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            fileExport.href = url;
            fileExport.download = 'conteudo_exportado.txt';
            fileExport.click();
            
            URL.revokeObjectURL(url);
            closeMenu();
        }
        
        function saveState() {
            const state = {
                items,
                originalItems,
                currentIndex,
                isQAMode,
                baseFontSize
            };
            localStorage.setItem('appState', JSON.stringify(state));
        }
        
        function loadState() {
            const savedState = localStorage.getItem('appState');
            return savedState ? JSON.parse(savedState) : null;
        }
        
        function performSearch() {
            searchTerm = searchInput.value.trim();
            if (!searchTerm) {
                clearSearch();
                return;
            }
            
            searchResults = [];
            
            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                let textToSearch = '';
                
                if (isQAMode) {
                    textToSearch = item.question + ' ' + item.answer;
                } else {
                    textToSearch = item.text;
                }
                
                if (textToSearch.toLowerCase().includes(searchTerm.toLowerCase())) {
                    searchResults.push(i);
                }
            }
            
            if (searchResults.length === 0) {
                searchInfo.textContent = 'Nenhum resultado encontrado para: ' + searchTerm;
                searchPrevBtn.disabled = true;
                searchNextBtn.disabled = true;
                return;
            }
            
            currentSearchIndex = 0;
            currentIndex = searchResults[currentSearchIndex];
            updateDisplay();
            updateSearchInfo();
        }
        
        function goToPrevSearchResult() {
            if (searchResults.length === 0) return;
            
            currentSearchIndex = (currentSearchIndex - 1 + searchResults.length) % searchResults.length;
            currentIndex = searchResults[currentSearchIndex];
            updateDisplay();
            updateSearchInfo();
        }
        
        function goToNextSearchResult() {
            if (searchResults.length === 0) return;
            
            currentSearchIndex = (currentSearchIndex + 1) % searchResults.length;
            currentIndex = searchResults[currentSearchIndex];
            updateDisplay();
            updateSearchInfo();
        }
        
        function updateSearchInfo() {
            if (searchResults.length === 0) {
                searchInfo.textContent = '';
            } else {
                searchInfo.textContent = `Resultado ${currentSearchIndex + 1} de ${searchResults.length}`;
            }
        }
        
        function updateSearchButtons() {
            searchPrevBtn.disabled = searchResults.length === 0 || currentSearchIndex <= 0;
            searchNextBtn.disabled = searchResults.length === 0 || currentSearchIndex >= searchResults.length - 1;
        }
        
        function highlightText() {
            if (!searchTerm) return;
            
            const highlight = (element, isCurrent) => {
                const text = element.textContent;
                const regex = new RegExp(searchTerm, 'gi');
                
                let newText = text.replace(regex, match => {
                    return `<span class="highlight">${match}</span>`;
                });
                
                if (isCurrent) {
                    newText = newText.replace(
                        new RegExp(searchTerm, 'i'), 
                        match => `<span class="current-highlight">${match}</span>`
                    );
                }
                
                element.innerHTML = newText;
            };
            
            if (isQAMode) {
                highlight(questionEl, true);
                highlight(answerEl, true);
            } else {
                highlight(questionEl, true);
            }
        }
        
        function clearSearch() {
            searchTerm = '';
            searchResults = [];
            currentSearchIndex = -1;
            searchInfo.textContent = '';
            searchPrevBtn.disabled = true;
            searchNextBtn.disabled = true;
            isFirstSearchClick = true;
            updateDisplay();
        }
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/faq/sw.js');
        }
    </script>
</body>
</html>
